<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de Expedientes Judiciales</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Configuración de color para el encabezado judicial (VERDE OSCURO) */
        .header-bg, .nav-bg, .footer-bg {
            background-color: #036635; /* Dark Green */
        }
        /* Estilos para el banner superior gris/rojo */
        .top-banner {
            background-color: #edeaea; /* Gris muy claro, similar a la imagen */
            border-bottom: 2px solid #8b0000; /* Borde rojo */
        }
        /* Estilos para el comunicado */
        .comunicado-box {
            border: 2px solid #8b0000; /* Borde rojo oscuro */
            background-color: #fefefe; /* Fondo blanco */
        }
        
        /* Estilos de reporte detallado - TODOS los títulos de sección usan este color verde */
        .report-section {
            background-color: #036635; 
            color: white;
            padding: 10px 20px;
            font-weight: bold;
            font-size: 1.125rem; /* text-lg */
            border-radius: 0.5rem 0.5rem 0 0;
            margin-top: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .report-grid-item {
            display: grid;
            grid-template-columns: 140px 1fr; /* Ajustado el ancho de la etiqueta */
            gap: 0.5rem;
            padding: 8px 0;
            border-bottom: 1px dashed #eee;
        }
        .report-grid-item strong {
            color: #333;
            font-weight: 600;
        }
        .report-grid-item span {
            color: #555;
            font-weight: normal;
        }
        .download-button {
            background-color: #036635;
            color: white;
            padding: 10px 20px;
            border-radius: 0.5rem;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            transition: background-color 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
        }
        .download-button:hover {
            background-color: #024a27; /* Un verde un poco más oscuro para el hover */
        }
        
        /* Estilo de item de etapa uniforme */
        .step-item {
            padding: 12px 0;
            border-bottom: 1px solid #e5e7eb; /* Separador gris claro */
        }
        .step-item:last-child {
            border-bottom: none; /* No hay borde después del último item */
        }
        
        /* Estilo para los botones de la etapa (VERDES) */
        .step-link-button {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            font-size: 0.875rem; /* text-sm */
            font-weight: 600; /* semi-bold */
            color: white;
            background-color: #036635; /* Verde principal */
            border-radius: 9999px; /* full rounded */
            transition: background-color 0.3s, transform 0.1s;
            margin-top: 4px; /* Espacio entre el texto y el botón */
        }
        .step-link-button:hover {
            background-color: #024a27; /* Verde más oscuro para hover */
            transform: translateY(-1px);
        }

        /* --- Estilo para el Botón CONSULTAR EXPEDIENTE --- */
        .consultar-button {
            background-color: #036635; /* Verde principal */
            color: white;
            font-bold;
            padding: 12px 20px; /* py-3 px-5 */
            border-radius: 0.75rem; /* rounded-xl */
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06); /* shadow-md */
            width: 100%;
            display: block;
        }
        .consultar-button:hover {
            background-color: #024a27; /* Un verde un poco más oscuro para el hover */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1); /* shadow-lg */
        }
        .consultar-button:focus {
            outline: none;
            ring: 4px; /* focus:ring-4 */
            ring-color: rgba(3, 102, 53, 0.5); /* focus:ring-judicial-red (con opacidad) */
            ring-opacity: 0.5;
        }
        
        /* Estilos para el contenido de Preguntas Frecuentes */
        .faq-item {
            padding: 16px 0;
            border-bottom: 1px solid #eee;
        }
        .faq-item:last-child {
            border-bottom: none;
        }
        .faq-question {
            color: #036635; /* Verde de la identidad visual */
            font-size: 1.125rem; /* text-lg */
            font-weight: 700; /* bold */
            margin-bottom: 4px;
        }
        .faq-answer {
            color: #4b5563; /* text-gray-600 */
            font-size: 1rem; /* text-base */
            line-height: 1.6;
        }
        /* Estilo para los enlaces de navegación como texto simple */
        .nav-link {
            padding: 10px 15px;
            cursor: pointer;
            transition: background-color 0.2s;
            border-radius: 0.25rem;
            text-transform: uppercase;
        }
        .nav-link:hover {
            background-color: #024a27; /* Verde más oscuro en hover */
        }

    </style>
    <script>
        // Configuración de Tailwind para usar la fuente Inter y colores personalizados
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'Arial', 'sans-serif'],
                    },
                    colors: {
                        'judicial-red': '#8b0000',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 font-sans min-h-screen flex flex-col">

    <div id="messageBox" class="fixed top-5 right-5 p-4 rounded-xl text-white transition-opacity duration-300 opacity-0 z-50 shadow-lg" role="alert" aria-live="polite"></div>

    <div class="top-banner px-4 py-3 flex justify-between items-start">
        <div class="space-y-1">
            <h1 class="text-xl font-extrabold text-gray-700 leading-none">PODER JUDICIAL DEL PERÚ</h1>
            <p class="text-xs text-gray-600 font-medium">Justicia Honorable, País Respetable</p>
        </div>
        
        <div class="text-right">
            <h2 class="text-lg font-bold text-gray-800 leading-none">Consulta de Expedientes</h2>
            <p class="text-xs text-gray-500">Versión 2.5.0</p>
            <p class="text-sm font-semibold text-judicial-red mt-1">Cortes Superiores de Justicia</p>
        </div>
    </div>

    <header class="nav-bg text-white py-2 shadow-lg">
        <div class="container mx-auto px-4 flex justify-between items-center text-sm font-semibold">
            <div class="flex space-x-2">
                <div class="nav-link" onclick="showSection('search')">INICIO</div>
                <div class="nav-link" onclick="showSection('video')">VIDEOTUTORIALES</div>
                <div class="nav-link" onclick="showSection('faq')">PREGUNTAS FRECUENTES</div>
            </div>
            <div id="timeInfo" class="text-right text-xs">
            </div>
        </div>
    </header>
    
    <div class="container mx-auto p-4 sm:p-6 lg:p-8 flex-grow">
        <div id="comunicadoBox" class="w-full max-w-4xl mx-auto comunicado-box p-4 text-center rounded-lg shadow-md mb-8">
            <h3 class="text-base font-extrabold text-judicial-red mb-2">FACULTAD DE CIENCIAS JURIDICAS Y POLITICAS - TRABAJO PRESENTADO: </h3>
            <p class="text-sm text-gray-700 leading-relaxed">
                - Alumna: YULISA CHATA QUISPE 
            </p>
            <p class="text-xs font-semibold text-gray-800 mt-2">
                Al amparo de la ley N° 29733, Ley de Protección de Datos Personales.
            </p>
        </div>
        
        <div class="w-full max-w-4xl mx-auto bg-white p-6 sm:p-8 rounded-xl shadow-2xl border border-gray-100" id="mainContentContainer">
            
            <div id="sectionSearch" class="content-section">
                
                <p class="text-sm text-gray-600 font-semibold mb-3 italic">* La búsqueda se deberá realizar ingresando el número, año y especialidad del expediente tal como se registró inicialmente en el sistema.</p>
                
                <div id="searchContainer">
                    <h2 class="text-2xl font-semibold mb-6 text-gray-800 border-b pb-2">BÚSQUEDA DE EXPEDIENTES</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="distrito" class="block text-sm font-medium text-gray-700 mb-1">Distrito Judicial (*)</label>
                            <select id="distrito" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-judicial-red focus:border-judicial-red transition duration-150">
                                <option>--SELECCIONAR</option>
                                <option>AMAZONAS</option><option>ANCASH</option><option>APURIMAC</option>
                                <option>AREQUIPA</option><option>AYACUCHO</option><option>CAJAMARCA</option>
                                <option>CALLAO</option><option>CAÑETE</option><option>CUSCO</option>
                                <option>DEL SANTA</option><option>HUANCAVELICA</option><option>HUANUCO</option>
                                <option>HUAURA</option><option>ICA</option><option>JUNIN</option>
                                <option>LA LIBERTAD</option><option>LAMBAYEQUE</option><option>LIMA</option>
                                <option>LIMA ESTE</option><option>LIMA NORTE</option><option>LIMA SUR</option>
                                <option>LORETO</option><option>MADRE DE DIOS</option><option>MOQUEGUA</option>
                                <option>PASCO</option><option>PIURA</option><option>PUNO</option>
                                <option>SAN MARTIN</option><option>SELVA CENTRAL</option><option>SULLANA</option>
                                <option>TACNA</option><option>TUMBES</option><option>UCAYALI</option>
                                <option>VENTANILLA - LIMA NOROESTE</option>
                            </select>
                        </div>

                        <div>
                            <label for="instancia" class="block text-sm font-medium text-gray-700 mb-1">Instancia (*)</label>
                            <select id="instancia" onchange="updateEspecialidad()" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-judicial-red focus:border-judicial-red transition duration-150">
                                <option>--SELECCIONAR</option>
                                <option>JUZGADO DE PAZ LETRADO</option>
                                <option>JUZGADO ESPECIALIZADO</option>
                                <option>JUZGADO MIXTO</option>
                                <option>SALA SUPERIOR</option>
                            </select>
                        </div>

                        <div>
                            <label for="especialidad" class="block text-sm font-medium text-gray-700 mb-1">Especialidad (*)</label>
                            <select id="especialidad" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-judicial-red focus:border-judicial-red transition duration-150">
                                <option>--SELECCIONAR</option>
                            </select>
                        </div>

                        <div>
                            <label for="anio" class="block text-sm font-medium text-gray-700 mb-1">Año (*)</label>
                            <input type="number" id="anio" placeholder="Ejemplo: 2025" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-judicial-red focus:border-judicial-red transition duration-150" min="1900" max="2100">
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <label for="expediente" class="block text-sm font-medium text-gray-700 mb-1">N° Expediente (*)</label>
                        <input type="text" id="expediente" placeholder="Ejemplo: 12345" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-judicial-red focus:border-judicial-red transition duration-150">
                    </div>

                    <div class="mt-6 flex flex-col sm:flex-row items-center gap-4 p-4 bg-gray-50 border border-gray-200 rounded-lg">
                        <div class="text-sm font-medium text-gray-700 shrink-0">Verificación de seguridad:</div>
                        <div class="captcha flex items-center gap-4 flex-grow">
                            <span class="captcha-code text-2xl font-extrabold tracking-widest bg-gray-300 text-gray-800 px-4 py-2 rounded-lg select-none shadow-inner" id="captchaCode"></span>
                            <input type="text" id="captchaInput" placeholder="Ingrese el código" class="flex-grow px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150 uppercase" maxlength="5">
                        </div>
                    </div>

                    <button onclick="buscarExpediente()" class="consultar-button mt-6">
                        CONSULTAR EXPEDIENTE
                    </button>
                </div>

                <div class="mt-8 result-container hidden" id="resultContainer">
                    <button onclick="mostrarBusqueda()" class="inline-flex items-center bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-xl transition duration-150 mb-6">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                        </svg>
                        Nueva Búsqueda
                    </button>
                    <div id="loadingIndicator" class="hidden text-center mt-6 text-lg font-medium text-judicial-red">Cargando resultados...</div>
                    
                    <div id="reporteDetallado"></div>
                </div>

            </div>
            <div id="sectionVideo" class="content-section hidden">
                <h2 class="text-2xl font-semibold mb-6 text-gray-800 border-b pb-2">GUÍA VISUAL DEL SISTEMA</h2>
                
                <div class="w-full aspect-video bg-gray-200 rounded-lg overflow-hidden shadow-xl">
                    <iframe 
                        src="https://www.youtube.com/embed/5DZBJXYF0Tk" 
                        frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen 
                        class="w-full h-full"
                        title="Video Tutorial - UNIVERSIDAD NACIONAL DEL ALTIPLANO">
                    </iframe>
                </div>

                <div class="mt-4 text-center">
                    <p class="text-sm text-gray-600 italic">Este video proporciona una guía introductoria sobre las actividades de la universidad, pero su estructura de reproducción es similar a un tutorial del sistema de consulta.</p>
                </div>
            </div>
            <div id="sectionFaq" class="content-section hidden">
                <h2 class="text-2xl font-semibold mb-6 text-gray-800 border-b pb-2">PREGUNTAS FRECUENTES (FAQ)</h2>
                
                <div class="space-y-4 divide-y divide-gray-100">
                    
                    <div class="faq-item">
                        <div class="faq-question">¿SE DEBE HACER ALGÚN TIPO DE PAGO PARA REALIZAR LAS BÚSQUEDAS?</div>
                        <div class="faq-answer">
                            <span class="font-bold text-judicial-red">NO</span>, el sistema es gratuito y de libre acceso al público en general.
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">¿QUÉ ME OFRECE EL SISTEMA?</div>
                        <div class="faq-answer">
                            El sistema te permite realizar búsquedas de un expediente. Se puede realizar búsquedas de los expedientes judiciales de la corte superior, tanto por código o ingresando ciertos datos pertenecientes al expediente. Se puede visualizar las resoluciones emitidas por las cortes, y la información en tiempo real.
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">¿CÓMO BUSCAR MI EXPEDIENTE?</div>
                        <div class="faq-answer">
                            Ingresar a: <a href="http://cej.pj.gob.pe/cej/" target="_blank" class="text-blue-600 hover:text-blue-800 underline">http://cej.pj.gob.pe/cej/</a>, seleccionar el tipo de búsqueda (por codigo o por filtro), seleccionar o ingresar los datos solicitados y click en el botón Consultar. Para un mejor manejo del Sistema, se sugiere visualizar la página de **Video Tutoriales**.
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">¿QUÉ SON LOS DISTRITOS JUDICIALES?</div>
                        <div class="faq-answer">
                            Son áreas de competencia de una determinada Corte Superior establecidas por ley.
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">¿QUÉ SON LAS INSTANCIAS?</div>
                        <div class="faq-answer">
                            Son jerarquías que se maneja en pirámide de justicia.
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">¿QUÉ SON LAS ESPECIALIDADES?</div>
                        <div class="faq-answer">
                            Es una clasificación del expediente, el cual puede ser de tipo **Civil**, **Familia**, **Laboral**, etc.
                        </div>
                    </div>

                </div>
            </div>
            </div>
    </div>

    <footer class="footer-bg text-white text-center py-4 mt-auto">
        <div class="h-3 bg-repeat-x bg-gray-600 mb-2" style="background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPSc1MCcgaGVpZ2h0PSc1MCc+CjxyZWN0IHdpZHRoPSc1MCcgaGVpZ2h0PSc1MCcgZmlsbD0nI2Q1ZDVkNScvPgo8cmVjdCB4PScx十三章IHk9JzEzJyB3aWR0aD0nMTInIGhlaWdodD0nMTInIGZpbGw9JyM4YzhjOGMnIC8+CjxyZWN0IHg9JzI1JyB5PScyNScgd2lkdGg9JzEyJyBoZWlnaHQ9JzEyJyBmaWxsPScjOGM4YzhjJyAvPgo8cmVjdCB4PScx十三章IHk9JzI1JyB3aWR0aD0nMTInIGhlaWdodD0nMTInIGZpbGw9JyNiYmJiYmInIC8+CjxyZWN0IHg9JzI1JyB5PScx十三章IHdpZHRoPScxMiMgaGVpZ2h0PScxMiIgZmlsbD0nI2JiYmJmJyAvPgo8cmVjdCB4PScxJyB5PScxJyB3aWR0aD0nMTInIGhlaWdodD0nMTInIGZpbGw9JyM1ZDVkNScgLz4KPHJlY3QgeD0nNDMnIHk9JzM3JyB3aWR0aD0nMTInIGhlaWdodD0nMTInIGZpbGw9JyM1ZDVkNScgLz4KPC9zdmc+'); background-size: 50px 50px;"></div>
        
        <p class="text-sm font-light mb-1">UNIVERSIDAD NACIONAL DEL ALTIPLANO PUNO - PUNO - PERU</p>
        <p class="text-xs font-semibold mb-1">Copyright ® - 2016 Todos los derechos reservados</p>
        <p class="text-xs font-light">Recomendado para Chrome, Mozilla Firefox, Anroid,Iphone </p>
    </footer>


    <script>
        // --- Data y Mapeo ---
        const especialidades = {
            "--SELECCIONAR": ["--SELECCIONAR"],
            "JUZGADO DE PAZ LETRADO": ["--SELECCIONAR", "CIVIL", "CONTENCIOSO ADMINISTRATIVO", "FAMILIA CIVIL", "FAMILIA TUTELAR", "LABORAL"],
            "JUZGADO ESPECIALIZADO": ["--SELECCIONAR", "CIVIL", "FAMILIA CIVIL", "FAMILIA TUTELAR"],
            "JUZGADO MIXTO": ["--SELECCIONAR", "CIVIL", "CONTENCIOSO ADMINISTRATIVO", "FAMILIA CIVIL", "FAMILIA TUTELAR", "LABORAL"],
            "SALA SUPERIOR": ["--SELECCIONAR", "CIVIL", "CONTENCIOSO ADMINISTRATIVO", "FAMILIA CIVIL", "FAMILIA TUTELAR", "LABORAL"]
        };
        
        // La URL de Google Sheets se mantiene
        const sheetURL = "https://docs.google.com/spreadsheets/d/1YykbF710wRkZze-A3Kf8OWt15GOR0DPznHP1Dp8VXEc/gviz/tq?tqx=out:json";

        // --- Mapeo de Columna Fija (Índices basados en 0, es decir: A=0, B=1, C=2, D=3, E=4) ---
        const COLUMN_INDICES = {
            DISTRITO: 0, // Columna A
            INSTANCIA: 1, // Columna B
            ESPECIALIDAD: 2, // Columna C
            ANIO: 3, // Columna D
            EXPEDIENTE: 4, // Columna E (¡El campo de validación principal!)
            NRO_EXPEDIENTE_DISPLAY: 4,
            
            // La URL del PDF se buscará por el encabezado "URL EXPEDIENTE"
            URL_PDF_HEADER_KEY: 'URL EXPEDIENTE' 
        };

        // --- Rango de Columnas para ETAPAS DEL PROCESO ---
        // U es el índice 20 (U=20)
        // AO es el índice 40 (AO=40)
        const ETAPAS_START_INDEX = 20; // Columna U
        const ETAPAS_END_INDEX = 40;   // Columna AO (inclusive)


        // --- Utilidades y Lógica de Interfaz ---
        
        /**
         * Actualiza la fecha y hora en tiempo real en el encabezado.
         */
        function updateTime() {
            const now = new Date();
            const dateOptions = { year: 'numeric', month: '2-digit', day: '2-digit' };
            const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
            
            // Formatear la fecha como DD/MM/AAAA (ej. 13/10/2025)
            const formattedDate = now.toLocaleDateString('es-PE', dateOptions);
            // Formatear la hora como HH:MM:SS (ej. 14:48:43)
            const formattedTime = now.toLocaleTimeString('es-PE', timeOptions);
            
            const timeInfoDiv = document.getElementById('timeInfo');
            // Nota: Se utiliza un tiempo de sesión fijo por simplicidad, ya que el cálculo real
            // de una sesión requiere lógica de servidor/cookies.
            timeInfoDiv.innerHTML = `
                Fecha: ${formattedDate}<br>
                Hora: ${formattedTime}<br>
                Tiempo restante de sesión: 04':26"
            `;
        }

        // Llamar a updateTime() cada segundo
        setInterval(updateTime, 1000);

        /**
         * Función para limpiar una cadena de texto, removiendo espacios, guiones y signos de puntuación, 
         * para hacer la comparación ultra-flexible. (Ej: 'LIMA-NORTE' -> 'LIMANORTE')
         * @param {string} text 
         * @returns {string} Texto limpio y en mayúsculas.
         */
        function ultraClean(text) {
            if (!text) return "";
            // Elimina cualquier caracter que no sea una letra o número, y convierte a mayúsculas
            return text.toString().trim().toUpperCase().replace(/[^A-Z0-9]/g, ''); 
        }

        /**
         * Verifica si una cadena parece ser una URL válida (inicia con http o tiene estructura de link).
         * @param {string} text 
         * @returns {boolean}
         */
        function isUrl(text) {
            if (!text) return false;
            const str = text.toString().trim().toLowerCase();
            // Criterios flexibles: debe ser largo y contener indicadores comunes de URL
            return str.length > 20 && (str.startsWith('http') || str.includes('.com') || str.includes('drive.google') || str.includes('doc.google') || str.includes('sheet.google'));
        }
        
        /**
         * Intenta formatear una cadena de texto a formato DD/MM/AAAA si parece una fecha.
         * @param {string} dateString 
         * @returns {string} Fecha formateada o cadena original.
         */
        function formatDate(dateString) {
            if (!dateString) return '';
            
            // Intenta detectar el formato de fecha ISO (YYYY-MM-DD o YYYY/MM/DD) o fecha de hoja de cálculo (MM/DD/YYYY)
            const parts = dateString.match(/(\d{4})[-/](\d{1,2})[-/](\d{1,2})/) || dateString.match(/(\d{1,2})[-/](\d{1,2})[-/](\d{4})/);
            
            if (parts && parts.length === 4) {
                let year, month, day;
                if (parts[1].length === 4) { // Formato YYYY-MM-DD
                    year = parts[1];
                    month = parts[2];
                    day = parts[3];
                } else { // Formato MM-DD-YYYY o similar (común en Sheets)
                    year = parts[3];
                    month = parts[1];
                    day = parts[2];
                }
                
                // Asegura que mes y día tengan dos dígitos
                const paddedMonth = month.padStart(2, '0');
                const paddedDay = day.padStart(2, '0');
                
                return `${paddedDay}/${paddedMonth}/${year}`;
            }
            
            // Si no coincide con un patrón de fecha, devuelve el original
            return dateString;
        }

        /**
         * Muestra un mensaje flotante (reemplazo de alert()).
         */
        function showMessage(message, type = 'error') {
            const box = document.getElementById('messageBox');
            box.textContent = message;
            
            box.classList.remove('bg-red-600', 'bg-green-600', 'opacity-100');
            box.classList.add('opacity-0'); 

            if (type === 'error') {
                box.classList.add('bg-red-600');
            } else if (type === 'success') {
                box.classList.add('bg-green-600');
            }

            requestAnimationFrame(() => {
                box.classList.add('opacity-100');
                box.classList.remove('opacity-0');
            });

            setTimeout(() => {
                box.classList.remove('opacity-100');
                box.classList.add('opacity-0');
            }, 4000);
        }

        // Generar captcha aleatorio
        function generarCaptcha() {
            const chars = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
            let code = "";
            for (let i = 0; i < 5; i++) code += chars.charAt(Math.floor(Math.random() * chars.length));
            document.getElementById("captchaCode").textContent = code;
            document.getElementById("captchaInput").value = ""; // Limpiar input del captcha
        }

        // Actualiza el select de Especialidad basado en la Instancia seleccionada
        function updateEspecialidad() {
            const instancia = document.getElementById("instancia").value;
            const especialidad = document.getElementById("especialidad");
            especialidad.innerHTML = "";
            
            const opts = especialidades[instancia] || especialidades["--SELECCIONAR"];

            opts.forEach(e => {
                const opt = document.createElement("option");
                opt.textContent = e;
                especialidad.appendChild(opt);
            });
        }
        
        // MODIFICADO: Función para mostrar la sección correcta (INICIO, VIDEOTUTORIALES, PREGUNTAS FRECUENTES)
        function showSection(sectionId) {
            // Ocultar todas las secciones
            document.querySelectorAll('.content-section').forEach(content => {
                content.classList.add('hidden');
            });

            // Mostrar la sección seleccionada
            document.getElementById(`section${sectionId.charAt(0).toUpperCase() + sectionId.slice(1)}`).classList.remove('hidden');

            // Lógica de visibilidad del comunicado
            const isSearchSection = sectionId === 'search';
            const isShowingResults = !document.getElementById("resultContainer").classList.contains("hidden");

            if (isSearchSection && !isShowingResults) {
                document.getElementById("comunicadoBox").classList.remove("hidden");
            } else {
                document.getElementById("comunicadoBox").classList.add("hidden");
            }
        }


        // Inicializar al cargar la página
        document.addEventListener('DOMContentLoaded', () => {
            generarCaptcha();
            updateEspecialidad();
            updateTime(); // Llamada inicial para mostrar la hora
            // Inicia en la sección de Búsqueda (INICIO)
            showSection('search'); 
        });

        // MODIFICADO: Ahora también controla la visibilidad del comunicado
        function mostrarResults() {
             document.getElementById("searchContainer").classList.add("hidden");
            document.getElementById("resultContainer").classList.remove("hidden");
            // Oculta el comunicado
            document.getElementById("comunicadoBox").classList.add("hidden"); 
        }
        
        // MODIFICADO: Ahora también controla la visibilidad del comunicado y limpia los campos
        function mostrarBusqueda() {
            document.getElementById("resultContainer").classList.add("hidden");
            document.getElementById("searchContainer").classList.remove("hidden");
            document.getElementById("reporteDetallado").innerHTML = "";
            generarCaptcha(); // Regenera el captcha

            // Muestra el comunicado (solo si estamos en la sección de Búsqueda/INICIO)
            if (!document.getElementById("sectionSearch").classList.contains("hidden")) {
                document.getElementById("comunicadoBox").classList.remove("hidden"); 
            }

            // Limpia los campos de búsqueda
            document.getElementById("distrito").value = "--SELECCIONAR";
            document.getElementById("instancia").value = "--SELECCIONAR";
            updateEspecialidad(); // Actualiza especialidad después de cambiar instancia
            document.getElementById("anio").value = "";
            document.getElementById("expediente").value = "";
        }


        // --- Lógica de Búsqueda (CON DIAGNÓSTICO DE ERROR Y COLUMNAS FIJAS) ---

        async function buscarExpediente() {
            // 1. Validar Captcha
            const codigo = document.getElementById("captchaCode").textContent;
            const entrada = document.getElementById("captchaInput").value.trim().toUpperCase();
            if (entrada !== codigo) {
                showMessage("Código de verificación incorrecto. Intente de nuevo.", 'error');
                generarCaptcha();
                return;
            }

            // 2. Validar campos obligatorios
            const distrito = document.getElementById("distrito").value;
            const instancia = document.getElementById("instancia").value;
            const especialidad = document.getElementById("especialidad").value;
            const anio = document.getElementById("anio").value.trim();
            const expediente = document.getElementById("expediente").value.trim();

            if (distrito === "--SELECCIONAR" || instancia === "--SELECCIONAR" || especialidad === "--SELECCIONAR" || !expediente || !anio) {
                showMessage("Por favor, complete todos los campos obligatorios (*).", 'error');
                generarCaptcha(); 
                return;
            }
            
            // Mostrar indicador de carga
            document.getElementById("loadingIndicator").classList.remove("hidden");
            document.getElementById("reporteDetallado").innerHTML = "";

            // 3. Preparar criterios de búsqueda (se limpian los secundarios)
            const searchCriteria = {
                expediente: expediente.trim().toUpperCase(), 
                anio: anio.trim().toUpperCase(), 
                distrito: ultraClean(distrito),
                instancia: ultraClean(instancia),
                especialidad: ultraClean(especialidad)
            };
            
            // Log para debug
            console.log("CRITERIOS DE BÚSQUEDA NORMALIZADOS Y LIMPIADOS:", searchCriteria);


            // 4. Conectar y Buscar en Google Sheets
            try {
                // Implementar lógica de reintento con backoff exponencial
                const maxRetries = 3;
                let response = null;

                for (let i = 0; i < maxRetries; i++) {
                    try {
                        response = await fetch(sheetURL);
                        if (response.ok) break; 
                        throw new Error(`Error HTTP: ${response.status}`);
                    } catch (e) {
                        if (i === maxRetries - 1) throw e; 
                        await new Promise(resolve => setTimeout(resolve, Math.pow(2, i) * 1000)); // Espera exponencial
                    }
                }
                
                if (!response.ok) {
                    throw new Error(`Fallo después de ${maxRetries} intentos. Código HTTP: ${response.status}`);
                }

                const text = await response.text();
                
                // Parsing específico para el formato JSONP de GSheets
                const jsonString = text.substring(47).slice(0, -2);
                const json = JSON.parse(jsonString);
                
                const rows = json.table.rows;
                const headers = json.table.cols.map(c => c.label);

                // 5. Filtrar datos con diagnóstico de error (usando índices de columna fijos)
                let foundMatch = null;
                // CAMBIO SOLICITADO ANTERIOR: Mensaje de error simplificado
                let errorReason = "No se encontró el Expediente N°: " + expediente + ".";

                // Transformar las filas de Google Sheets a objetos usando los encabezados
                const allDataObjects = rows.map(r => {
                    const obj = {};
                    r.c.forEach((cell, index) => {
                        // Usar el valor (v) o la cadena formateada (f) if the value is null
                        obj[headers[index]] = (cell && cell.v !== undefined) ? cell.v : (cell && cell.f !== undefined) ? cell.f : "";
                    });
                    return obj;
                });
                
                // 5.1. PRIMER FILTRO: N° Expediente (Columna E, índice 4)
                const expedientMatches = allDataObjects.filter(obj => {
                    // Obtener el valor del N° Expediente usando la posición fija (encabezado)
                    const rowExpediente = (obj[headers[COLUMN_INDICES.EXPEDIENTE]] || "").toString().trim().toUpperCase();
                    // El valor del Expediente de la BD DEBE CONTENER el valor del formulario.
                    return rowExpediente.includes(searchCriteria.expediente); 
                });
                
                if (expedientMatches.length === 0) {
                    // errorReason ya está establecido al inicio con el mensaje simplificado.
                } else {
                    // 5.2. SEGUNDO FILTRO Y DIAGNÓSTICO: Validar los 4 criterios secundarios (A, B, C, D)
                    for (const obj of expedientMatches) {
                        // Función auxiliar para obtener el valor del Sheet por índice
                        const getRowValueByIndex = (index) => (obj[headers[index]] || "").toString();

                        // Preparar valores del Sheet para comparación
                        const rowAnio = getRowValueByIndex(COLUMN_INDICES.ANIO).trim().toUpperCase();
                        const rowDistritoClean = ultraClean(getRowValueByIndex(COLUMN_INDICES.DISTRITO));
                        const rowInstanciaClean = ultraClean(getRowValueByIndex(COLUMN_INDICES.INSTANCIA));
                        const rowEspecialidadClean = ultraClean(getRowValueByIndex(COLUMN_INDICES.ESPECIALIDAD));
                        
                        // Validaciones
                        const matchAnio = rowAnio.includes(searchCriteria.anio);
                        const matchDistrito = rowDistritoClean.includes(searchCriteria.distrito); 
                        const matchInstancia = rowInstanciaClean.includes(searchCriteria.instancia);
                        const matchEspecialidad = rowEspecialidadClean.includes(searchCriteria.especialidad); 

                        if (matchAnio && matchDistrito && matchInstancia && matchEspecialidad) {
                            // Coincidencia perfecta encontrada
                            foundMatch = obj;
                            break; 
                        } else {
                            // Si el Expediente coincidió, pero fallaron los secundarios, diagnosticamos cuál falló
                            if (!matchAnio) {
                                errorReason = `El Expediente N° ${expediente} fue encontrado, pero el **Año (${headers[COLUMN_INDICES.ANIO]})** es incorrecto. Valor esperado: ${searchCriteria.anio}. Valor en BD: ${rowAnio}.`;
                            } else if (!matchDistrito) {
                                errorReason = `El Expediente N° ${expediente} fue encontrado, pero el **Distrito Judicial (${headers[COLUMN_INDICES.DISTRITO]})** es incorrecto. Valor esperado (limpio): ${searchCriteria.distrito}. Valor en BD (limpio): ${rowDistritoClean}.`;
                            } else if (!matchInstancia) {
                                errorReason = `El Expediente N° ${expediente} fue encontrado, pero la **Instancia (${COLUMN_INDICES.INSTANCIA})** es incorrecta. Valor esperado (limpio): ${searchCriteria.instancia}. Valor en BD (limpio): ${rowInstanciaClean}.`;
                            } else if (!matchEspecialidad) {
                                errorReason = `El Expediente N° ${expediente} fue encontrado, pero la **Especialidad (${COLUMN_INDICES.ESPECIALIDAD})** es incorrecta. Valor esperado (limpio): ${searchCriteria.especialidad}. Valor en BD (limpio): ${rowEspecialidadClean}.`;
                            }
                        }
                    }
                }
            
                // --- CONTINUACIÓN DEL BLOQUE DE CÓDIGO INICIAL (PARTE 1) ---
                document.getElementById("loadingIndicator").classList.add("hidden");

                if (foundMatch) {
                    // Necesitamos pasar el nombre del encabezado del Expediente para que funcione el display
                    const expedienteHeader = headers[COLUMN_INDICES.EXPEDIENTE];
                    
                    // PASO CRÍTICO: Obtenemos el encabezado para el PDF
                    const urlPdfHeader = COLUMN_INDICES.URL_PDF_HEADER_KEY; 
                    
                    mostrarResults(); // Muestra resultados y OCULTA comunicado
                    mostrarResultadosDetallados(headers, foundMatch, expedienteHeader, urlPdfHeader); 
                    showMessage(`Expediente encontrado y detallado.`, 'success');
                } else {
                    // Se usa el errorReason simplificado aquí
                    const finalErrorDisplay = errorReason.startsWith("No se encontró") 
                        ? `<p class="font-semibold text-red-700">Error de Coincidencia:</p><p class="text-sm mt-1">${errorReason}</p><p class="text-xs mt-2 text-gray-500">Asegúrese de que el Expediente, Año y el Distrito/Instancia/Especialidad en su hoja de cálculo coincidan lo suficiente, ignorando espacios y guiones.</p>`
                        : `<p class="font-semibold text-red-700">Error de Coincidencia:</p><p class="text-sm mt-1">${errorReason}</p><p class="text-xs mt-2 text-gray-500">El N° Expediente fue encontrado, pero los filtros secundarios no coincidieron.</p>`;

                    document.getElementById("reporteDetallado").innerHTML = `<div class="text-center p-8 bg-gray-50 border border-dashed border-red-300 rounded-lg text-gray-600">${finalErrorDisplay}</div>`;
                    showMessage("Búsqueda fallida: " + errorReason.replace(/\*\*/g, '').replace(/\<br\>/g, ' '), 'error');
                    mostrarResults(); // Muestra resultados y OCULTA comunicado para ver el mensaje de error
                    console.error("DIAGNÓSTICO DE FALLO:", errorReason);
                }

            } catch (e) {
                document.getElementById("loadingIndicator").classList.add("hidden");
                showMessage(`Error grave en la conexión/parsing de la Base de Datos. Detalle: ${e.message}`, 'error');
                console.error("Error al obtener o parsear Google Sheets:", e);
                mostrarBusqueda(); 
            }
        } // Cierre de la función buscarExpediente()


        // --- Lógica de Generación de HTML ---

        /**
         * Genera el HTML del reporte detallado (sección principal, partes procesales y etapas del proceso).
         */
        function mostrarResultadosDetallados(headers, data, nroExpedienteHeader, urlPdfHeader) {
            const reporteDetalladoDiv = document.getElementById("reporteDetallado");
            reporteDetalladoDiv.innerHTML = ""; 

            // Obtener el N° Expediente para el título
            const displayExpediente = data[nroExpedienteHeader] || document.getElementById("expediente").value;

            // Obtener la URL del PDF y verificar que sea una URL válida, buscándola por el HEADER KEY
            const rawPdfUrl = data[urlPdfHeader] || null;
            const pdfUrl = rawPdfUrl && isUrl(rawPdfUrl) ? rawPdfUrl : null;

            // --- 1. Generar Reporte de Expediente (Sección Superior) ---
            const mainReportHtml = generarReporteExpediente(headers, data, nroExpedienteHeader, displayExpediente, pdfUrl);

            // --- 2. Generar Partes Procesales (Sección Media) ---
            const partesReportHtml = generarReportePartes(data);

            // --- 3. Generar Etapas del Proceso (Sección Inferior) ---
            const etapasReportHtml = generarReporteEtapas(headers, data);
            
            // 4. Insertar todos los reportes
            reporteDetalladoDiv.innerHTML = mainReportHtml + partesReportHtml + etapasReportHtml;
        }

        /**
         * Auxiliar para generar el HTML de la sección de REPORTE DE EXPEDIENTE.
         * Se añade 'pdfUrl' para generar el botón.
         */
        function generarReporteExpediente(headers, data, nroExpedienteHeader, displayExpediente, pdfUrl) {
            
            // Mapeo de columnas a mostrar en el detalle
            const fieldMapExpediente = {
                [nroExpedienteHeader]: 'N° EXPEDIENTE', 
                'ORGANO JURISDICCIONAL': 'ÓRGANO JURISDICCIONAL',
                'JUEZ': 'JUEZ',
                'FECHA DE INICIO': 'FECHA DE INICIO',
                'MATERIA(S)': 'MATERIA(S)',
                'ETAPA PROCESAL': 'ETAPA PROCESAL',
                'UBICACION': 'UBICACIÓN',
                'SUMILLA': 'SUMILLA',
                'ESPECIALISTA LEGAL': 'ESPECIALISTA LEGAL',
                'PROCESO': 'PROCESO',
                'ESTADO': 'ESTADO',
                'FECHA CONCLUSION': 'FECHA CONCLUSIÓN',
                'MOTIVO CONCLUSION': 'MOTIVO CONCLUSIÓN',
                // Excluimos la columna de URL PDF del detalle
                [COLUMN_INDICES.URL_PDF_HEADER_KEY]: null, 
            };

            let leftGridItems = '';
            let rightGridItems = '';
            let fieldIndex = 0;
            const fieldsToShow = Object.keys(fieldMapExpediente);

            fieldsToShow.forEach(sheetHeader => {
                // Si el mapeo es nulo, se omite (usado para la URL PDF)
                if (fieldMapExpediente[sheetHeader] === null) return; 
                
                const label = fieldMapExpediente[sheetHeader];
                let value = data[sheetHeader] ? String(data[sheetHeader]).trim() : '---'; 
                
                // Si el valor es una URL, la reemplazamos con '---' para que no se muestre como texto en este detalle
                if (isUrl(value)) {
                    value = '---'; 
                }

                if (data.hasOwnProperty(sheetHeader) && value !== '---') { 
                    const itemHtml = `
                        <div class="report-grid-item">
                            <strong class="text-xs sm:text-sm text-gray-700 uppercase">${label}:</strong>
                            <span class="text-sm font-semibold text-gray-900 break-words">${value}</span>
                        </div>
                    `;

                    if (fieldIndex % 2 === 0) {
                        leftGridItems += itemHtml;
                    } else {
                        rightGridItems += itemHtml;
                    }
                    fieldIndex++;
                }
            });

            // Generar el botón de descarga solo si existe la URL válida. 
            let downloadButtonHtml = '';
            if (pdfUrl) {
                downloadButtonHtml = `
                    <div class="mt-6 md:mt-8 md:col-span-2 flex justify-center md:justify-end">
                        <a href="${pdfUrl}" target="_blank" class="download-button">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                            </svg>
                            DESCARGAR EXPEDIENTE (PDF)
                        </a>
                    </div>
                `;
            } 
            // Si pdfUrl es null, no se genera el div de descarga.

            return `
                <div class="report-section rounded-t-xl mt-0">
                    1. REPORTE DE EXPEDIENTE
                    <span class="text-sm font-normal">${displayExpediente}</span>
                </div>
                <div class="bg-white p-6 border-x border-b border-gray-200">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-4">
                        <div class="space-y-1">${leftGridItems}</div>
                        <div class="space-y-1">${rightGridItems}</div>
                    </div>
                    ${downloadButtonHtml}
                </div>
            `;
        }

        /**
         * Auxiliar para generar el HTML de la sección de PARTES PROCESALES.
         */
        function generarReportePartes(data) {
            const parteDemandante = data['PARTE DEMANDANTE'] || data['DEMANDANTE'] || '---';
            const parteDemandado = data['PARTE DEMANDADO'] || data['DEMANDADO'] || '---';
            const tipoPersona = data['TIPO DE PERSONA'] || '---'; 

            const demandantes = parteDemandante.split('\n').filter(p => p.trim() !== '' && p.trim() !== '---');
            const demandados = parteDemandado.split('\n').filter(p => p.trim() !== '' && p.trim() !== '---');

            let partesRowsHtml = '';

            // Llenar tabla con Demandantes
            if (demandantes.length > 0) {
                demandantes.forEach(name => {
                    partesRowsHtml += `
                        <tr class="hover:bg-gray-50 transition duration-150">
                            <td class="py-3 px-4 text-judicial-red font-bold">DEMANDANTE</td>
                            <td class="py-3 px-4">${tipoPersona}</td>
                            <td class="py-3 px-4 font-medium" colspan="3">${name.trim()}</td>
                        </tr>
                    `;
                });
            }

            // Llenar tabla con Demandados
            if (demandados.length > 0) {
                demandados.forEach(name => {
                    partesRowsHtml += `
                        <tr class="hover:bg-gray-50 transition duration-150">
                            <td class="py-3 px-4 text-blue-800 font-bold">DEMANDADO</td>
                            <td class="py-3 px-4">${tipoPersona}</td>
                            <td class="py-3 px-4 font-medium" colspan="3">${name.trim()}</td>
                        </tr>
                    `;
                });
            }

            // Si no hay información de partes, mostrar una fila de "No hay partes"
            if (demandantes.length === 0 && demandados.length === 0) {
                partesRowsHtml = `
                    <tr class="text-center">
                        <td class="py-3 px-4 text-gray-500 italic" colspan="5">No hay información de Partes Procesales disponible para este expediente.</td>
                    </tr>
                `;
            }


            return `
                <div class="report-section">
                    2. PARTES PROCESALES
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path d="M10 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1z" clip-rule="evenodd" fill-rule="evenodd"></path></svg>
                </div>
                <div class="bg-white p-6 border-x border-b border-gray-200 overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead>
                            <tr class="bg-gray-100 text-gray-600 uppercase text-xs">
                                <th class="py-3 px-4 font-bold text-left">ROL</th>
                                <th class="py-3 px-4 font-bold text-left">TIPO DE PERSONA</th>
                                <th class="py-3 px-4 font-bold text-left" colspan="3">NOMBRE / RAZÓN SOCIAL</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200 whitespace-nowrap text-sm text-gray-700">
                            ${partesRowsHtml}
                        </tbody>
                    </table>
                </div>
            `;
        }

        /**
         * Auxiliar para generar el HTML de la sección de ETAPAS DEL PROCESO.
         */
        function generarReporteEtapas(headers, data) {
            let etapas = [];
            
            // 1. Recorrer el rango de columnas U (índice 20) hasta AO (índice 40)
            for (let i = ETAPAS_START_INDEX; i <= ETAPAS_END_INDEX; i++) {
                const header = headers[i];
                const rawValue = data[header] ? String(data[header]).trim() : '';
                
                if (rawValue && rawValue !== '---') {
                    // Limpiar el encabezado (quitar números/guiones/caracteres extraños para display)
                    const cleanedHeader = header.replace(/^\d+\.\s*/, '').replace(/[-_]/g, ' ').trim();
                    
                    let content;
                    
                    // Comprobación CRÍTICA: Si el valor es una URL, generamos un botón simplificado
                    if (isUrl(rawValue)) {
                        // El texto del botón es fijo: "VER DOCUMENTO"
                        const buttonText = "VER DOCUMENTO";
                        
                        // Generamos el botón con un ícono de enlace
                        content = `
                            <a href="${rawValue}" target="_blank" class="step-link-button">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 10-2.828-2.828l-5.741 5.741a2 2 0 00-1.287 1.287l-1.01 4.706a1 1 0 001.26 1.26l4.706-1.01a2 2 0 001.287-1.287l5.741-5.741zM17 17a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
                                </svg>
                                ${buttonText}
                            </a>
                        `;
                    } else {
                        // Si no es URL, formateamos el valor (asumiendo que es una fecha o texto)
                        const formattedValue = formatDate(rawValue);
                        content = `<span class="text-sm text-gray-600">${formattedValue}</span>`;
                    }
                    
                    etapas.push({
                        header: cleanedHeader,
                        contentHtml: content
                    });
                }
            }

            let etapasHtml = '';
            const totalEtapas = etapas.length;

            if (totalEtapas > 0) {
                // 2. Iterar sobre las etapas encontradas para generar el HTML
                etapas.forEach((etapa, index) => {
                    const stepClass = 'step-item';
                    const headerColor = 'text-gray-800';
                    const iconColor = 'bg-gray-400';

                    etapasHtml += `
                        <div class="flex items-start ${stepClass}">
                            <div class="w-3 h-3 mt-1.5 mr-3 rounded-full ${iconColor} flex-shrink-0"></div>
                            <div class="flex-grow">
                                <strong class="block text-sm font-semibold uppercase ${headerColor}">${etapa.header}:</strong>
                                ${etapa.contentHtml}
                            </div>
                        </div>
                    `;
                });
            } else {
                    etapasHtml = `<p class="p-4 text-center text-sm text-gray-500 italic">No hay datos de etapas procesales en el rango de columnas U a AO para este expediente.</p>`;
            }

            return `
                <div class="report-section">
                    3. ETAPAS DEL PROCESO
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v5a1 1 0 001 1h3a1 1 0 100-2h-3V7z" clip-rule="evenodd" /></svg>
                </div>
                <div class="bg-white p-6 border-x border-b border-gray-200 rounded-b-xl">
                    <div class="space-y-1">
                        ${etapasHtml}
                    </div>
                </div>
            `;
        }

    </script>
</body>
</html>
